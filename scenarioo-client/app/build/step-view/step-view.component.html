<!-- scenarioo-client
Copyright (C) 2014, scenarioo.org Development Team

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->

<!-- TODO: idea for future ...
<sc-page-loading
    [loadingObservable]="stepObservable"> -->

    <sc-detailarea key="stepView" *ngIf="step"
        [mainDetailsSections]="mainDetailsSections"
        [additionalDetailsSections]="additionalDetailsSections">

        <sc-title scenarioName="{{scenarioName | scHumanReadable}}"
                  stepIndex="{{getCurrentStepIndexForDisplay()}}"></sc-title>

        <sc-progressbar [stepNavigation]="stepNavigation"
                        [stepStatistics]="stepStatistics"></sc-progressbar>

        <div class="stepView">

            <tabset #stepViewTabs>
                <tab heading="Screenshot" id="screenshot-tab" (selectTab)="setActiveTab('screenshot-tab')">
                    <div class="stepNavRow">
                        <div (click)="goStepBack()" class="stepNavButton stepNavCell left" [ngClass]="stepNavigation?.stepIndex === 0 ? 'step-arrow-grey':'step-arrow'">
                            <i class="fas stepNavArrow fa-angle-left"></i>
                        </div>
                        <sc-annotated-screenshot class="stepNavCell"
                                                 [screenAnnotations]="step?.screenAnnotations"
                                                 [screenShotUrl]="screenShotUrl"
                                                 [visibilityToggle]="true">
                        </sc-annotated-screenshot>
                        <div (click)="goStepForward()" class="stepNavButton stepNavCell right" [ngClass]="stepNavigation?.stepIndex === (stepStatistics?.totalNumberOfStepsInScenario - 1) ? 'step-arrow-grey':'step-arrow'">
                            <i class="fas stepNavArrow fa-angle-right"></i>
                        </div>
                    </div>
                </tab>

                <tab *ngIf="step?.html" heading="HTML" id="html-tab" (selectTab)="setActiveTab('html-tab')">
                    <pre [textContent]="step.html.htmlSource" id="html-source"></pre>
                </tab>

                <!-- Diff Viewer Step Comparison View -->
                <tab  *ngIf="isComparisonExisting"
                      id="comparison-tab"
                      (selectTab)="setActiveTab('comparison-tab')">
                    <ng-template tabHeading>
                        <span class="">Comparison&nbsp;</span>
                        <span class="sc-label sc-label-after-text">
                            <sc-diff-info-icon [diffInfo]="step?.diffInfo"
                                               childElementType="screenshot"
                                               elementType="screenshot"></sc-diff-info-icon>
                        </span>
                    </ng-template>

                    <sc-comparison-view [step]="step"
                                        [stepIdentifier]="stepIdentifier"
                                        [stepIndex]="stepNavigation.stepIndex"
                                        [screenShotUrl]="screenShotUrl"></sc-comparison-view>

                </tab>

                <tab *ngIf="step?.screenAnnotations?.length !== 0" id="toggleScreenAnnotationsDisplayed">
                    <ng-template tabHeading>
                        <sc-screen-annotations-button [screenAnnotations]="step?.screenAnnotations"></sc-screen-annotations-button>
                    </ng-template>
                </tab>

            </tabset>

        </div>

    </sc-detailarea>

<!-- </sc-page-loading> -->
